
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Création de Personnage v2</title>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/> 
  <style>
    body {
      font-family: 'Uncial Antiqua', cursive;
      background-size: cover;
      background-color: #fdf6e3;
      color: #3b2f1e;
      margin: 0;
      padding: 40px;
    }
    h1, h2 {
      text-align: center;
      text-shadow: 1px 1px 2px #00000050;
    }
    .section {
      position: relative;
      background: rgba(255, 248, 220, 0.9);
      border: 4px solid #8b5e3c;
      border-radius: 12px;
      padding: 50px 20px 20px 20px;
      margin-bottom: 30px;
      box-shadow: 0 0 10px #3b2f1e99;
      overflow: hidden;
    }
    .section h2 {
      position: absolute;
      top: -20px;
      left: 20px;
      background: rgba(255, 248, 220, 0.95);
      padding: 0 10px;
      font-size: 20px;
      color: #5c3b21;
      border: 2px solid #8b5e3c;
      border-radius: 8px;
      box-shadow: 2px 2px 4px #00000040;
      z-index: 2;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }
    .field {
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #3b2f1e;
    }
    input, textarea, select {
      font-family: 'Uncial Antiqua', cursive;
      padding: 6px 10px;
      font-size: 16px;
      background: #fefae0;
      border: 2px solid #8b5e3c;
      border-radius: 6px;
      box-shadow: inset 0 0 4px #8b5e3c44;
      box-sizing: border-box;
      width: 100%;
    }
    textarea {
      resize: vertical;
      height: 100px;
    }
    button {
      font-family: 'Uncial Antiqua', cursive;
      padding: 10px 30px;
      font-size: 18px;
      background: #8b5e3c;
      color: #fefae0;
      border: 2px solid #5c3b21;
      border-radius: 8px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
    }
    button:hover {
      background: #5c3b21;
    }
    @media (max-width: 768px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 480px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>Création de Personnage v2</h1>
  <div class="section">
    <h2>Informations Générales</h2>
    <div class="grid">
      <div class="field"><label>Nom</label><input id="player_name" type="text"></div>
      <div class="field"><label>Classe</label><select id="player_class"></select></div>
      <div class="field"><label>Race</label><select id="player_race"></select></div>
      <div class="field"><label>Niveau</label><input id="player_level" type="number" min="1"></div>
    </div>
  </div>
  <div class="section">
    <h2>Statistiques</h2>
    <div class="grid">
      <div class="field"><label>Force</label><input id="stat_force" type="number"></div>
      <div class="field"><label>Dextérité</label><input id="stat_dexterite" type="number"></div>
      <div class="field"><label>Magie</label><input id="stat_magie" type="number"></div>
      <div class="field"><label>Constitution</label><input id="stat_constitution" type="number"></div>
      <div class="field"><label>Charisme</label><input id="stat_charisme" type="number"></div>
      <div class="field"><label>Perception</label><input id="stat_perception" type="number"></div>
      <div class="field"><label>Chance</label><input id="stat_chance" type="number"></div>
      <div class="field"><label>Intelligence</label><input id="stat_intelligence" type="number"></div>
    </div>
  </div>
  <div class="section">
    <h2>Survie et Défense</h2>
    <div class="grid">
      <div class="field"><label>Vie</label><input id="player_hp" type="number"></div>
      <div class="field" style="display: none;"><input id="player_hp_current" type="hidden"></div>
      <div class="field"><label>Mana</label><input id="player_mana" type="number"></div>
      <div class="field" style="display: none;"><input id="player_mana_current" type="hidden"></div>
      <div class="field"><label>Vie bonus</label><input id="def_bonus_vie" type="number"></div>
      <div class="field"><label>Intox.</label><input id="def_intox" type="text"></div>
    </div><!-- fin du grid -->
  </div>

    <div class="sections-container">
        <!-- Section Sac -->
        <div class="section">
            <h2>Sac</h2>
            <div class="content-area">
                <textarea id="eq_sac"></textarea>
            </div>
        </div>
    
        <!-- Section Ceinture/dos -->
        <div class="section">
            <h2>Ceinture/dos</h2>
            <div class="content-area">
                <textarea id="eq_ceinture"></textarea>
            </div>
        </div>
    
        <!-- Section Armes -->
        <div class="section">
            <h2>Armes</h2>
            <table class="weapons-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Dégâts</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><input id="weapon_type_1" type="text"></td><td><input id="weapon_dmg_1" type="text"></td></tr>
                    <tr><td><input id="weapon_type_2" type="text"></td><td><input id="weapon_dmg_2" type="text"></td></tr>
                    <tr><td><input id="weapon_type_3" type="text"></td><td><input id="weapon_dmg_3" type="text"></td></tr>
                    <tr><td><input id="weapon_type_4" type="text"></td><td><input id="weapon_dmg_4" type="text"></td></tr>
                    <tr><td><input id="weapon_type_5" type="text"></td><td><input id="weapon_dmg_5" type="text"></td></tr>
                </tbody>
            </table>
        </div>
    
        <!-- Section Armure -->
        <div class="section">
            <h2>Armures</h2>
            <div class="armor-section">
                <div class="armor-fields">
                  <div class="field"><label>Type d'armure</label><select id="eq_armure"></select></div>
                    <div class="field"><label>Résistance</label><input id="eq_resistance" type="text"></div>
                    <div class="field"><label>Durabilité</label><input id="eq_durabilite" type="number"></div>
                    <div class="field" style="display: none;"><input id="eq_durabilite_current" type="hidden"></div>
      
                    <div class="field">
                      <label>État de l'armure</label>
                      <input type="text" id="player_armor" readonly>
                      <div id="armor_effect" class="status-text"></div>
                    </div>
                    <div class="field"><label>Valeur protection</label><input id="eq_val_protect" type="number"></div>
                  </div>
                <!-- Silhouette humaine -->
                <div class="human-silhouette" style="flex-shrink: 0;">
                    <img src="img/silhouette-homme.jpg" alt="Silhouette humaine" style="max-width: 100px; height: auto;">
                </div>
            </div>
        </div>
    </div>


    <div class="double-section-container">
        <div class="section">
            <h2>Sorts </h2>
            <div class="grid-3">
                <div class="field"><label>Nom</label><input id="spell_name_1" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="spell_dmg_1" type="text"></div>
                <div class="field"><label>Niveau</label><input id="spell_lvl_1" type="number" min="1"></div>
                <div class="field"><label>Nom</label><input id="spell_name_2" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="spell_dmg_2" type="text"></div>
                <div class="field"><label>Niveau</label><input id="spell_lvl_2" type="number" min="1"></div>
                <div class="field"><label>Nom</label><input id="spell_name_3" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="spell_dmg_3" type="text"></div>
                <div class="field"><label>Niveau</label><input id="spell_lvl_3" type="number" min="1"></div>
              </div>
        </div>
            
        <div class="section">
            <h2>Attaques Spéciales</h2>
            <div class="grid-3">
                <div class="field"><label>Nom</label><input id="special_name_1" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="special_dmg_1" type="text"></div>
                <div class="field"><label>Niveau</label><input id="special_lvl_1" type="number" min="1"></div>
                <div class="field"><label>Nom</label><input id="special_name_2" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="special_dmg_2" type="text"></div>
                <div class="field"><label>Niveau</label><input id="special_lvl_2" type="number" min="1"></div>
                <div class="field"><label>Nom</label><input id="special_name_3" type="text"></div>
                <div class="field"><label>Dégâts</label><input id="special_dmg_3" type="text"></div>
                <div class="field"><label>Niveau</label><input id="special_lvl_3" type="number" min="1"></div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Sorts mineurs</h2>
        <div class="grid-3">
          <div class="field"><label>Nom</label><input id="minispell_name_1" type="text"></div>
          <div class="field"><label>Dégâts</label><input id="minispell_dmg_1" type="text"></div>
          <div class="field"><label>Nom</label><input id="minispell_name_2" type="text"></div>
          <div class="field"><label>Dégâts</label><input id="minispell_dmg_2" type="text"></div>
        </div>
    </div>

  <div class="section">
    <h2>Compétences de classe et passifs</h2>
    <table class="competences-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Effets</th>
          <th>Niveau</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input id="class_skill_name_1" type="text"></td>
          <td><input id="class_skill_effect_1" type="text"></td>
          <td><input id="class_skill_lvl_1" type="number" min="1"></td>
        </tr>
        <tr>
          <td><input id="class_skill_name_2" type="text"></td>
          <td><input id="class_skill_effect_2" type="text"></td>
          <td><input id="class_skill_lvl_2" type="number" min="1"></td>
        </tr>
        <tr>
          <td><input id="class_skill_name_3" type="text"></td>
          <td><input id="class_skill_effect_3" type="text"></td>
          <td><input id="class_skill_lvl_3" type="number" min="1"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="section">
    <h2>Compétences spéciales du personnage</h2>
    <div class="field">
      <textarea id="skills_speciales"></textarea>
    </div>
  </div>

  <div class="section">
    <h2>Biographie</h2>
    <div class="field">
      <textarea id="bio"></textarea>
    </div>
  </div>

  <div class="section">
    <h2>Choix de level up et Effets permanents</h2>
    <div class="field">
      <textarea id="levelup"></textarea>
    </div>
  </div>

  <div style="text-align: center;">
    <button id="save_player_creation">Sauvegarder</button>
  </div>

  <script>
    const options = {
      classes: ["Guerrier", "Paladin", "Mage", "Marchand", "Ranger", "Druide", "Aventurier", "Sorceleur"],
      races: ["Humain", "Nain", "Elfe", "Draconnir", "Demi-Elfe", "Humnigar", "Ecorfal"],
      armures: ["Armure légère", "Armure moyenne", "Armure lourde"]
    };
    const classSelect = document.getElementById('player_class');
    const raceSelect = document.getElementById('player_race');
    const armorSelect = document.getElementById('eq_armure');
    options.classes.forEach(cl => { const opt = document.createElement('option'); opt.value = cl; opt.textContent = cl; classSelect.appendChild(opt); });
    options.races.forEach(rc => { const opt = document.createElement('option'); opt.value = rc; opt.textContent = rc; raceSelect.appendChild(opt); });
    options.armures.forEach(ar => { const opt = document.createElement('option'); opt.value = ar; opt.textContent = ar; armorSelect.appendChild(opt); });

    document.getElementById('save_player_creation').addEventListener('click', () => {
      const required = ['player_name', 'player_class', 'player_race', 'player_level'];
      for (const id of required) {
        if (!document.getElementById(id).value) {
          alert('Veuillez remplir tous les champs requis.');
          return;
        }
      }

            // Copie les valeurs max vers les valeurs "actuelles"
    document.getElementById('player_hp_current').value = document.getElementById('player_hp').value;
    document.getElementById('player_mana_current').value = document.getElementById('player_mana').value;
    document.getElementById('eq_durabilite_current').value = document.getElementById('eq_durabilite').value;


    const data = {
      nom: document.getElementById('player_name').value,
      classe: document.getElementById('player_class').value,
      race: document.getElementById('player_race').value,
      niveau: parseInt(document.getElementById('player_level').value),
      stats: {
        force: parseInt(document.getElementById('stat_force').value),
        dexterite: parseInt(document.getElementById('stat_dexterite').value),
        magie: parseInt(document.getElementById('stat_magie').value),
        constitution: parseInt(document.getElementById('stat_constitution').value),
        charisme: parseInt(document.getElementById('stat_charisme').value),
        perception: parseInt(document.getElementById('stat_perception').value),
        chance: parseInt(document.getElementById('stat_chance').value),
        intelligence: parseInt(document.getElementById('stat_intelligence').value)
      },
      bio: document.getElementById('bio').value,
      sac: document.getElementById('eq_sac').value,
      ceinture: document.getElementById('eq_ceinture').value,
      armure: {
        type: document.getElementById('eq_armure').value,
        resistance: document.getElementById('eq_resistance').value,
        durabilite: parseInt(document.getElementById('eq_durabilite').value),
        protection: parseInt(document.getElementById('eq_val_protect').value)
      },
      mana: parseInt(document.getElementById('player_mana').value),
      vie: parseInt(document.getElementById('player_hp').value),
      bonus_vie: parseInt(document.getElementById('def_bonus_vie').value),
      intox: document.getElementById('def_intox').value,
      spells: [
        {
          nom: document.getElementById('spell_name_1').value,
          degats: document.getElementById('spell_dmg_1').value,
          niveau: parseInt(document.getElementById('spell_lvl_1').value)
        },
        {
          nom: document.getElementById('spell_name_2').value,
          degats: document.getElementById('spell_dmg_2').value,
          niveau: parseInt(document.getElementById('spell_lvl_2').value)
        },
        {
          nom: document.getElementById('spell_name_3').value,
          degats: document.getElementById('spell_dmg_3').value,
          niveau: parseInt(document.getElementById('spell_lvl_3').value)
        }
      ],
      attaques_speciales: [
        {
          nom: document.getElementById('special_name_1').value,
          degats: document.getElementById('special_dmg_1').value,
          niveau: parseInt(document.getElementById('special_lvl_1').value)
        },
        {
          nom: document.getElementById('special_name_2').value,
          degats: document.getElementById('special_dmg_2').value,
          niveau: parseInt(document.getElementById('special_lvl_2').value)
        },
        {
          nom: document.getElementById('special_name_3').value,
          degats: document.getElementById('special_dmg_3').value,
          niveau: parseInt(document.getElementById('special_lvl_3').value)
        }
      ],
      sorts_mineurs: [
        {
          nom: document.getElementById('minispell_name_1').value,
          degats: document.getElementById('minispell_dmg_1').value
        },
        {
          nom: document.getElementById('minispell_name_2').value,
          degats: document.getElementById('minispell_dmg_2').value
        }
      ],
      competences: [
        {
          nom: document.getElementById('class_skill_name_1').value,
          effet: document.getElementById('class_skill_effect_1').value,
          niveau: parseInt(document.getElementById('class_skill_lvl_1').value)
        },
        {
          nom: document.getElementById('class_skill_name_2').value,
          effet: document.getElementById('class_skill_effect_2').value,
          niveau: parseInt(document.getElementById('class_skill_lvl_2').value)
        },
        {
          nom: document.getElementById('class_skill_name_3').value,
          effet: document.getElementById('class_skill_effect_3').value,
          niveau: parseInt(document.getElementById('class_skill_lvl_3').value)
        }
      ],
      skills_speciales: document.getElementById('skills_speciales').value,
      levelup: document.getElementById('levelup').value,
      armes: [
        {
          type: document.getElementById('weapon_type_1').value,
          degats: document.getElementById('weapon_dmg_1').value
        },
        {
          type: document.getElementById('weapon_type_2').value,
          degats: document.getElementById('weapon_dmg_2').value
        },
        {
          type: document.getElementById('weapon_type_3').value,
          degats: document.getElementById('weapon_dmg_3').value
        },
        {
          type: document.getElementById('weapon_type_4').value,
          degats: document.getElementById('weapon_dmg_4').value
        },
        {
          type: document.getElementById('weapon_type_5').value,
          degats: document.getElementById('weapon_dmg_5').value
        }
      ]
    };



    fetch('/api/joueurs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        return res.json();
      })
      .then(json => {
        console.log('Réponse du serveur :', json);
        alert('Joueur enregistré avec succès !');
        window.location.href = '/selecte_player.html';
      })
      .catch(err => {
        console.error(err);
        alert("Erreur lors de l'enregistrement du joueur.");
      });
    });
  </script>
</body>
</html>
