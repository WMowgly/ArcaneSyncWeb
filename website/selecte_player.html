<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>MJ - ArcaneSync</title>
  <link rel="stylesheet" href="style.css"/> 
  <link rel="icon" type="image/png" href="img/icon.png"/>
</head>
<body>
  <h1>Selection du joueur</h1>
  <a href="index.html">
    <button id="retour_accueil">Accueil</button>
  </a>

  <!-- Zone pour afficher les joueurs -->
  <h2>Liste des joueurs</h2>
  <div id="joueurs-list"></div>

  <script>
    // Récupérer les joueurs depuis l'API
    fetch('http://localhost:3000/api/joueurs')
      .then(response => response.json())
      .then(joueurs => {
        const listContainer = document.getElementById('joueurs-list');
        
        // Si aucun joueur, afficher un message
        if (joueurs.length === 0) {
          listContainer.innerHTML = '<p>Aucun joueur enregistré.</p>';
        } else {
          joueurs.forEach(joueur => {
            const card = document.createElement('div');
            card.classList.add('card');
            card.setAttribute('data-id', joueur.nom);

            // Ajout des informations du joueur dans la carte
            card.innerHTML = `
              <h3>${joueur.nom}</h3>
              <p>Race: ${joueur.race}</p>
              <p>Classe: ${joueur.classe}</p>
              <p>HP: ${joueur.hp}</p>
              <p>Mana: ${joueur.mana}</p>
              <button class="delete-btn">Supprimer</button>
            `;

            // Suppression de personnage
            const deleteBtn = card.querySelector('.delete-btn'); 

            deleteBtn.addEventListener('click', (e) => {
              e.stopPropagation(); // Évite le déclenchement de la sélection

              if (confirm(`Supprimer le joueur ${joueur.nom} ?`)) {
                fetch(`http://localhost:3000/api/joueurs/delete}`, {
                  method: 'DELETE'
                })
                .then(res => res.text())
                .then(message => {
                  console.log("Réponse serveur :", message);
                  //card.remove();
                })
                .catch(err => {
                  console.error("Erreur suppression:", err);
                  alert("Erreur lors de la suppression du joueur.");
                });
              }
            });

            // Gérer la sélection du joueur
            card.addEventListener('click', () => {
              document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
              card.classList.add('selected');
              alert(`Vous avez sélectionné le joueur: ${joueur.nom}`);
            });

            // Ajouter la carte à la liste
            listContainer.appendChild(card);
          });
        }
      })
      .catch(err => {
        console.error("Erreur lors de la récupération des joueurs:", err);
        alert("Erreur lors de la récupération des joueurs.");
      });
  </script>
</body>
</html>
